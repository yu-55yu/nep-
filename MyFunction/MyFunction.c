#include "MyFunction.h"

#define DDS_CLK 1000000000
extern u8 CFR1[];
u8 RAM_PRO0[8];
u32 RAM_AMP_SQUARE_WAVE2[] = 
{
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,
	0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,0x0000fffc,	
	
	
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,
	0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,0x7ffffffc,	
};


void SPI_Refresh(void)
{
	AD9910_IUP_Clr;
	Delay_ns (100);																									// 更新AD9910
	AD9910_IUP_Set;
	Delay_ns (100);
	AD9910_IUP_Clr;
	Delay_ns (100);
}

void SPI_WriteRegister(uint8_t reg,uint8_t regSize, uint8_t *value)
{
	AD9910_CSN_Clr;
	Write_8bit(reg);																									// 将CFR1写入其寄存器0x00
	for(int j=0;j<regSize;j++)
	{
		Write_8bit(value[j]);
	}
	AD9910_CSN_Set;	
	Delay_ns (100);
}

void SetFreq(float Freq)
{
	uint32_t FreqWord = (uint32_t)(DDS_CLK/4.0/1024.0/Freq);	// 计算频率调谐字
	CFR1[0] = 0xe0;
	RAM_PRO0[1] = (FreqWord >> 8) & 0xFF;	
	RAM_PRO0[2] = FreqWord  & 0xFF;	

	SPI_WriteRegister(0x00,4,CFR1);
	SPI_WriteRegister(0x0e,8,RAM_PRO0);
	SPI_Refresh();
}

void Paramter_Init(void)
{
	u8 CFR1_Init[]={0x60,0x40,0x00,0x00};															// 开启AD9910反Sinc滤波
	u8 RAM_PRO0_Init[]={0x00,0x00,0x01,0xff,0xc0,0x00,0x00,0x00};					// 设置RAM的起始和终止地址、地址步进率
	for(int i=0;i<4;i++)
	{
		CFR1[i] = CFR1_Init[i];																							// 初始化CFR1寄存器
	}
	for(int i=0;i<8;i++)
	{
		RAM_PRO0[i] = RAM_PRO0_Init[i];																			// 初始化RAM_PRO0寄存器
	}
	SPI_WriteRegister(0x00,4,CFR1);
	SPI_WriteRegister(0x0e,8,RAM_PRO0);
	SPI_Refresh();
}

void Write_Waveform(void)
{
	AD9910_CSN_Clr;																// 初始化参数
	Write_8bit(0x16);														// 写入ram地址
	for(int j=0; j<1024; j++)
	{	
		Write_32bit(RAM_AMP_SQUARE_WAVE2[j]);														//将方波的数据写入ram	
	}
	AD9910_CSN_Set;

	SPI_Refresh();
}

void AD9910_Freq_W(float Freq)
{
	Paramter_Init();
	Write_Waveform();	// 写入方波数据
	SetFreq(Freq);	
}


