#include "DDS.h"

uint16_t SINEWAVE[WAVE_POINT] = {
 2048,2052,2056,2060,2064,2068,2073,2077,2081,2085,2089,2094,2098,2102,2106,2110,
2114,2119,2123,2127,2131,2135,2139,2144,2148,2152,2156,2160,2164,2168,2173,2177,
2181,2185,2189,2193,2197,2201,2205,2209,2213,2218,2222,2226,2230,2234,2238,2242,
2246,2250,2254,2258,2262,2266,2270,2274,2278,2282,2285,2289,2293,2297,2301,2305,
2309,2313,2317,2320,2324,2328,2332,2336,2340,2343,2347,2351,2355,2358,2362,2366,
2369,2373,2377,2380,2384,2388,2391,2395,2399,2402,2406,2409,2413,2416,2420,2423,
2427,2430,2434,2437,2441,2444,2448,2451,2454,2458,2461,2464,2468,2471,2474,2478,
2481,2484,2487,2490,2494,2497,2500,2503,2506,2509,2512,2515,2518,2521,2524,2527,
2530,2533,2536,2539,2542,2545,2548,2551,2554,2556,2559,2562,2565,2567,2570,2573,
2575,2578,2581,2583,2586,2589,2591,2594,2596,2599,2601,2603,2606,2608,2611,2613,
2615,2618,2620,2622,2625,2627,2629,2631,2633,2635,2638,2640,2642,2644,2646,2648,
2650,2652,2654,2656,2658,2659,2661,2663,2665,2667,2668,2670,2672,2674,2675,2677,
2679,2680,2682,2683,2685,2686,2688,2689,2691,2692,2693,2695,2696,2697,2699,2700,
2701,2702,2703,2705,2706,2707,2708,2709,2710,2711,2712,2713,2714,2715,2716,2717,
2717,2718,2719,2720,2720,2721,2722,2722,2723,2724,2724,2725,2725,2726,2726,2727,
2727,2728,2728,2728,2729,2729,2729,2729,2730,2730,2730,2730,2730,2730,2730,2730,
2731,2730,2730,2730,2730,2730,2730,2730,2730,2729,2729,2729,2729,2728,2728,2728,
2727,2727,2726,2726,2725,2725,2724,2724,2723,2722,2722,2721,2720,2720,2719,2718,
2717,2717,2716,2715,2714,2713,2712,2711,2710,2709,2708,2707,2706,2705,2703,2702,
2701,2700,2699,2697,2696,2695,2693,2692,2691,2689,2688,2686,2685,2683,2682,2680,
2679,2677,2675,2674,2672,2670,2668,2667,2665,2663,2661,2659,2658,2656,2654,2652,
2650,2648,2646,2644,2642,2640,2638,2635,2633,2631,2629,2627,2625,2622,2620,2618,
2615,2613,2611,2608,2606,2603,2601,2599,2596,2594,2591,2589,2586,2583,2581,2578,
2575,2573,2570,2567,2565,2562,2559,2556,2554,2551,2548,2545,2542,2539,2536,2533,
2530,2527,2524,2521,2518,2515,2512,2509,2506,2503,2500,2497,2494,2490,2487,2484,
2481,2478,2474,2471,2468,2464,2461,2458,2454,2451,2448,2444,2441,2437,2434,2430,
2427,2423,2420,2416,2413,2409,2406,2402,2399,2395,2391,2388,2384,2380,2377,2373,
2369,2366,2362,2358,2355,2351,2347,2343,2340,2336,2332,2328,2324,2320,2317,2313,
2309,2305,2301,2297,2293,2289,2285,2282,2278,2274,2270,2266,2262,2258,2254,2250,
2246,2242,2238,2234,2230,2226,2222,2218,2213,2209,2205,2201,2197,2193,2189,2185,
2181,2177,2173,2168,2164,2160,2156,2152,2148,2144,2139,2135,2131,2127,2123,2119,
2114,2110,2106,2102,2098,2094,2089,2085,2081,2077,2073,2068,2064,2060,2056,2052,
2048,2043,2039,2035,2031,2027,2022,2018,2014,2010,2006,2001,1997,1993,1989,1985,
1981,1976,1972,1968,1964,1960,1956,1951,1947,1943,1939,1935,1931,1927,1922,1918,
1914,1910,1906,1902,1898,1894,1890,1886,1882,1877,1873,1869,1865,1861,1857,1853,
1849,1845,1841,1837,1833,1829,1825,1821,1817,1813,1810,1806,1802,1798,1794,1790,
1786,1782,1778,1775,1771,1767,1763,1759,1755,1752,1748,1744,1740,1737,1733,1729,
1726,1722,1718,1715,1711,1707,1704,1700,1696,1693,1689,1686,1682,1679,1675,1672,
1668,1665,1661,1658,1654,1651,1647,1644,1641,1637,1634,1631,1627,1624,1621,1617,
1614,1611,1608,1605,1601,1598,1595,1592,1589,1586,1583,1580,1577,1574,1571,1568,
1565,1562,1559,1556,1553,1550,1547,1544,1541,1539,1536,1533,1530,1528,1525,1522,
1520,1517,1514,1512,1509,1506,1504,1501,1499,1496,1494,1492,1489,1487,1484,1482,
1480,1477,1475,1473,1470,1468,1466,1464,1462,1460,1457,1455,1453,1451,1449,1447,
1445,1443,1441,1439,1437,1436,1434,1432,1430,1428,1427,1425,1423,1421,1420,1418,
1416,1415,1413,1412,1410,1409,1407,1406,1404,1403,1402,1400,1399,1398,1396,1395,
1394,1393,1392,1390,1389,1388,1387,1386,1385,1384,1383,1382,1381,1380,1379,1378,
1378,1377,1376,1375,1375,1374,1373,1373,1372,1371,1371,1370,1370,1369,1369,1368,
1368,1367,1367,1367,1366,1366,1366,1366,1365,1365,1365,1365,1365,1365,1365,1365,
1365,1365,1365,1365,1365,1365,1365,1365,1365,1366,1366,1366,1366,1367,1367,1367,
1368,1368,1369,1369,1370,1370,1371,1371,1372,1373,1373,1374,1375,1375,1376,1377,
1378,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1389,1390,1392,1393,
1394,1395,1396,1398,1399,1400,1402,1403,1404,1406,1407,1409,1410,1412,1413,1415,
1416,1418,1420,1421,1423,1425,1427,1428,1430,1432,1434,1436,1437,1439,1441,1443,
1445,1447,1449,1451,1453,1455,1457,1460,1462,1464,1466,1468,1470,1473,1475,1477,
1480,1482,1484,1487,1489,1492,1494,1496,1499,1501,1504,1506,1509,1512,1514,1517,
1520,1522,1525,1528,1530,1533,1536,1539,1541,1544,1547,1550,1553,1556,1559,1562,
1565,1568,1571,1574,1577,1580,1583,1586,1589,1592,1595,1598,1601,1605,1608,1611,
1614,1617,1621,1624,1627,1631,1634,1637,1641,1644,1647,1651,1654,1658,1661,1665,
1668,1672,1675,1679,1682,1686,1689,1693,1696,1700,1704,1707,1711,1715,1718,1722,
1726,1729,1733,1737,1740,1744,1748,1752,1755,1759,1763,1767,1771,1775,1778,1782,
1786,1790,1794,1798,1802,1806,1810,1813,1817,1821,1825,1829,1833,1837,1841,1845,
1849,1853,1857,1861,1865,1869,1873,1877,1882,1886,1890,1894,1898,1902,1906,1910,
1914,1918,1922,1927,1931,1935,1939,1943,1947,1951,1956,1960,1964,1968,1972,1976,
1981,1985,1989,1993,1997,2001,2006,2010,2014,2018,2022,2027,2031,2035,2039,2043
};
uint16_t TRIANGLEWAVE[WAVE_POINT] = {
 2048,2052,2056,2060,2064,2068,2073,2077,2081,2085,2089,2094,2098,2102,2106,2110,
2114,2119,2123,2127,2131,2135,2139,2144,2148,2152,2156,2160,2164,2168,2173,2177,
2181,2185,2189,2193,2197,2201,2205,2209,2213,2218,2222,2226,2230,2234,2238,2242,
2246,2250,2254,2258,2262,2266,2270,2274,2278,2282,2285,2289,2293,2297,2301,2305,
2309,2313,2317,2320,2324,2328,2332,2336,2340,2343,2347,2351,2355,2358,2362,2366,
2369,2373,2377,2380,2384,2388,2391,2395,2399,2402,2406,2409,2413,2416,2420,2423,
2427,2430,2434,2437,2441,2444,2448,2451,2454,2458,2461,2464,2468,2471,2474,2478,
2481,2484,2487,2490,2494,2497,2500,2503,2506,2509,2512,2515,2518,2521,2524,2527,
2530,2533,2536,2539,2542,2545,2548,2551,2554,2556,2559,2562,2565,2567,2570,2573,
2575,2578,2581,2583,2586,2589,2591,2594,2596,2599,2601,2603,2606,2608,2611,2613,
2615,2618,2620,2622,2625,2627,2629,2631,2633,2635,2638,2640,2642,2644,2646,2648,
2650,2652,2654,2656,2658,2659,2661,2663,2665,2667,2668,2670,2672,2674,2675,2677,
2679,2680,2682,2683,2685,2686,2688,2689,2691,2692,2693,2695,2696,2697,2699,2700,
2701,2702,2703,2705,2706,2707,2708,2709,2710,2711,2712,2713,2714,2715,2716,2717,
2717,2718,2719,2720,2720,2721,2722,2722,2723,2724,2724,2725,2725,2726,2726,2727,
2727,2728,2728,2728,2729,2729,2729,2729,2730,2730,2730,2730,2730,2730,2730,2730,
2731,2730,2730,2730,2730,2730,2730,2730,2730,2729,2729,2729,2729,2728,2728,2728,
2727,2727,2726,2726,2725,2725,2724,2724,2723,2722,2722,2721,2720,2720,2719,2718,
2717,2717,2716,2715,2714,2713,2712,2711,2710,2709,2708,2707,2706,2705,2703,2702,
2701,2700,2699,2697,2696,2695,2693,2692,2691,2689,2688,2686,2685,2683,2682,2680,
2679,2677,2675,2674,2672,2670,2668,2667,2665,2663,2661,2659,2658,2656,2654,2652,
2650,2648,2646,2644,2642,2640,2638,2635,2633,2631,2629,2627,2625,2622,2620,2618,
2615,2613,2611,2608,2606,2603,2601,2599,2596,2594,2591,2589,2586,2583,2581,2578,
2575,2573,2570,2567,2565,2562,2559,2556,2554,2551,2548,2545,2542,2539,2536,2533,
2530,2527,2524,2521,2518,2515,2512,2509,2506,2503,2500,2497,2494,2490,2487,2484,
2481,2478,2474,2471,2468,2464,2461,2458,2454,2451,2448,2444,2441,2437,2434,2430,
2427,2423,2420,2416,2413,2409,2406,2402,2399,2395,2391,2388,2384,2380,2377,2373,
2369,2366,2362,2358,2355,2351,2347,2343,2340,2336,2332,2328,2324,2320,2317,2313,
2309,2305,2301,2297,2293,2289,2285,2282,2278,2274,2270,2266,2262,2258,2254,2250,
2246,2242,2238,2234,2230,2226,2222,2218,2213,2209,2205,2201,2197,2193,2189,2185,
2181,2177,2173,2168,2164,2160,2156,2152,2148,2144,2139,2135,2131,2127,2123,2119,
2114,2110,2106,2102,2098,2094,2089,2085,2081,2077,2073,2068,2064,2060,2056,2052,
2048,2043,2039,2035,2031,2027,2022,2018,2014,2010,2006,2001,1997,1993,1989,1985,
1981,1976,1972,1968,1964,1960,1956,1951,1947,1943,1939,1935,1931,1927,1922,1918,
1914,1910,1906,1902,1898,1894,1890,1886,1882,1877,1873,1869,1865,1861,1857,1853,
1849,1845,1841,1837,1833,1829,1825,1821,1817,1813,1810,1806,1802,1798,1794,1790,
1786,1782,1778,1775,1771,1767,1763,1759,1755,1752,1748,1744,1740,1737,1733,1729,
1726,1722,1718,1715,1711,1707,1704,1700,1696,1693,1689,1686,1682,1679,1675,1672,
1668,1665,1661,1658,1654,1651,1647,1644,1641,1637,1634,1631,1627,1624,1621,1617,
1614,1611,1608,1605,1601,1598,1595,1592,1589,1586,1583,1580,1577,1574,1571,1568,
1565,1562,1559,1556,1553,1550,1547,1544,1541,1539,1536,1533,1530,1528,1525,1522,
1520,1517,1514,1512,1509,1506,1504,1501,1499,1496,1494,1492,1489,1487,1484,1482,
1480,1477,1475,1473,1470,1468,1466,1464,1462,1460,1457,1455,1453,1451,1449,1447,
1445,1443,1441,1439,1437,1436,1434,1432,1430,1428,1427,1425,1423,1421,1420,1418,
1416,1415,1413,1412,1410,1409,1407,1406,1404,1403,1402,1400,1399,1398,1396,1395,
1394,1393,1392,1390,1389,1388,1387,1386,1385,1384,1383,1382,1381,1380,1379,1378,
1378,1377,1376,1375,1375,1374,1373,1373,1372,1371,1371,1370,1370,1369,1369,1368,
1368,1367,1367,1367,1366,1366,1366,1366,1365,1365,1365,1365,1365,1365,1365,1365,
1365,1365,1365,1365,1365,1365,1365,1365,1365,1366,1366,1366,1366,1367,1367,1367,
1368,1368,1369,1369,1370,1370,1371,1371,1372,1373,1373,1374,1375,1375,1376,1377,
1378,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1389,1390,1392,1393,
1394,1395,1396,1398,1399,1400,1402,1403,1404,1406,1407,1409,1410,1412,1413,1415,
1416,1418,1420,1421,1423,1425,1427,1428,1430,1432,1434,1436,1437,1439,1441,1443,
1445,1447,1449,1451,1453,1455,1457,1460,1462,1464,1466,1468,1470,1473,1475,1477,
1480,1482,1484,1487,1489,1492,1494,1496,1499,1501,1504,1506,1509,1512,1514,1517,
1520,1522,1525,1528,1530,1533,1536,1539,1541,1544,1547,1550,1553,1556,1559,1562,
1565,1568,1571,1574,1577,1580,1583,1586,1589,1592,1595,1598,1601,1605,1608,1611,
1614,1617,1621,1624,1627,1631,1634,1637,1641,1644,1647,1651,1654,1658,1661,1665,
1668,1672,1675,1679,1682,1686,1689,1693,1696,1700,1704,1707,1711,1715,1718,1722,
1726,1729,1733,1737,1740,1744,1748,1752,1755,1759,1763,1767,1771,1775,1778,1782,
1786,1790,1794,1798,1802,1806,1810,1813,1817,1821,1825,1829,1833,1837,1841,1845,
1849,1853,1857,1861,1865,1869,1873,1877,1882,1886,1890,1894,1898,1902,1906,1910,
1914,1918,1922,1927,1931,1935,1939,1943,1947,1951,1956,1960,1964,1968,1972,1976,
1981,1985,1989,1993,1997,2001,2006,2010,2014,2018,2022,2027,2031,2035,2039,2043
};

uint32_t place[2]={0};
uint32_t ctrl_word1;
uint32_t ctrl_word2;
uint32_t phase_word[2]={0};
uint8_t phaseFlag[2]={1};
uint16_t pData1[WAVE_POINT]={0};
uint16_t pData2[WAVE_POINT]={0};
extern uint16_t DAC_Buffer1[WAVE_POINT];
extern uint16_t DAC_Buffer2[WAVE_POINT];
Signal Wave[2];


extern SignalType gwave_type[2];


void phaseChange(float phaseValue,int Channal)//相位改变代码
{
    phase_word[Channal]=(uint32_t)(phaseValue/(PI*2)*4294967295.0);
    place[Channal]+=phase_word[Channal];
    // if(phaseFlag[Channal]==1)
    // {
    //     phaseFlag[Channal]=0;
    //  place[Channal]+=phase_word[Channal];
       
    // }
}
void DDS_SetWaveform(Signal Waves, int Channel) {
    uint16_t *waveform = NULL;
    waveform = Waves.Type == TRIANGLE ? TRIANGLEWAVE : SINEWAVE;
    if (Channel == 0) {
        for (int i = 0; i < WAVE_POINT; i++) {
            DAC_Buffer1[i] = waveform[i];
        }
    } else if (Channel == 1) {
        for (int i = 0; i < WAVE_POINT; i++) {
            DAC_Buffer2[i] = waveform[i];
        }
    }
}
// 设置波形参数
void DDS_SetParameter(Signal wave[]) {
	ctrl_word1=Wave[0].Freq*OF;
    ctrl_word2=Wave[1].Freq*OF;
	for(int i=0; i<2; i++)
	{
		DDS_SetWaveform(Wave[i],i);
	}
}